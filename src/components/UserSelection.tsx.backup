import React, { useState } from 'react';
import {
  Box,
  Card,
            {/* SÃ©lecteur de langue */}
          <Box sx={{ position: 'absolute', top: 20, left: 20 }}>
            <FormControl size="small" sx={{ minWidth: 120 }}>
              <Select
                value={currentLanguage}
                onChange={(e) => setLanguage(e.target.value as any)}
                sx={{
                  backgroundColor: 'rgba(255, 255, 255, 0.9)',
                  borderRadius: 2,
                  fontWeight: 'bold',
                  '& .MuiSelect-select': {
                    display: 'flex',
                    alignItems: 'center',
                    gap: 1,
                    py: 1,
                  },
                }}
                startAdornment={<LanguageIcon sx={{ mr: 1, color: '#667eea' }} />}
              >
                {availableLanguages.map((lang) => (
                  <MenuItem key={lang.code} value={lang.code}>
                    <Box sx={{ display: 'flex', alignItems: 'center', gap: 1 }}>
                      <span>{lang.flag}</span>
                      <span>{lang.name}</span>
                    </Box>
                  </MenuItem>
                ))}
              </Select>
            </FormControl>
          </Box>

          <Typography
            variant="h3"
            sx={{
              fontFamily: '"Fredoka One", cursive',
              color: 'white',
              textAlign: 'center',
              textShadow: '2px 2px 4px rgba(0,0,0,0.3)',
            }}
          >
            {t.t('ui.selectUser')}
          </Typography>
          
          {/* Bouton Administration */}
          <IconButton Typography,
  Button,
  Avatar,
  Grid,
  IconButton,
  FormControl,
  Select,
  MenuItem,
  InputLabel,
} from '@mui/material';
import { Add as AddIcon, ManageAccounts as AdminIcon, Language as LanguageIcon } from '@mui/icons-material';
import { motion } from 'framer-motion';
import { User } from '../App';
import AdminPanel from './AdminPanel';
import { useLanguage } from '../contexts/LanguageContext';
import { useTranslation } from '../utils/translations';

interface UserSelectionProps {
  users: User[];
  onSelectUser: (user: User) => void;
  onCreateUser: (userData: Omit<User, 'id' | 'createdAt'>) => Promise<User | null>;
  onShowCreateForm: () => void;
}

const UserSelection: React.FC<UserSelectionProps> = ({
  users,
  onSelectUser,
  onCreateUser,
  onShowCreateForm,
}) => {
  const [adminPanelOpen, setAdminPanelOpen] = useState(false);
  const [adminAuthorized, setAdminAuthorized] = useState(false);
  
  const { currentLanguage, setLanguage, availableLanguages } = useLanguage();
  const t = useTranslation(currentLanguage);

  const handleAdminAuthorization = (password: string): boolean => {
    if (password === 'admin123') {
      setAdminAuthorized(true);
      return true;
    }
    return false;
  };

  return (
    <Box
      sx={{
        height: '100vh',
        display: 'flex',
        flexDirection: 'column',
        alignItems: 'center',
        justifyContent: 'center',
        background: 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)',
        p: 2,
      }}
    >
      <motion.div
        initial={{ y: -20, opacity: 0 }}
        animate={{ y: 0, opacity: 1 }}
        transition={{ duration: 0.6 }}
      >
        <Box sx={{ position: 'relative', mb: 4 }}>
          <Typography
            variant="h2"
            sx={{
              fontFamily: '"Fredoka One", cursive',
              color: 'white',
              textAlign: 'center',
              textShadow: '2px 2px 4px rgba(0,0,0,0.3)',
            }}
          >
            Qui va apprendre aujourd'hui ? ðŸŒŸ
          </Typography>
          
          {/* Bouton Administration */}
          <IconButton
            onClick={() => setAdminPanelOpen(true)}
            sx={{
              position: 'absolute',
              top: 0,
              right: 0,
              bgcolor: '#FF6B35',
              color: 'white',
              width: 56,
              height: 56,
              border: '3px solid #FF8A65',
              boxShadow: '0 4px 16px rgba(255, 107, 53, 0.4)',
              '&:hover': { 
                bgcolor: '#E55A2B',
                transform: 'scale(1.05)',
                boxShadow: '0 6px 20px rgba(255, 107, 53, 0.6)',
              },
              transition: 'all 0.3s ease',
            }}
            title="Interface d'Administration"
          >
            <AdminIcon sx={{ fontSize: '1.8rem' }} />
          </IconButton>
        </Box>
      </motion.div>

      <Box sx={{ 
        maxWidth: 800, 
        maxHeight: '60vh', 
        overflowY: 'auto',
        pr: 1,
      }}>
        <Grid container spacing={3}>
          {users.map((user, index) => (
          <Grid item xs={12} sm={6} md={4} key={user.id}>
            <motion.div
              initial={{ scale: 0, opacity: 0 }}
              animate={{ scale: 1, opacity: 1 }}
              transition={{ delay: index * 0.1, duration: 0.5 }}
              whileHover={{ scale: 1.05 }}
              whileTap={{ scale: 0.95 }}
            >
              <Card
                sx={{
                  cursor: 'pointer',
                  borderRadius: 4,
                  boxShadow: '0 8px 32px rgba(0,0,0,0.1)',
                  transition: 'all 0.3s ease',
                  '&:hover': {
                    boxShadow: '0 12px 40px rgba(0,0,0,0.2)',
                  },
                }}
                onClick={() => onSelectUser(user)}
              >
                <CardContent sx={{ textAlign: 'center', p: 3 }}>
                  <Avatar
                    sx={{
                      width: 80,
                      height: 80,
                      fontSize: '3rem',
                      mx: 'auto',
                      mb: 2,
                      bgcolor: '#f0f4ff',
                      border: '3px solid #667eea',
                    }}
                  >
                    {user.avatar}
                  </Avatar>
                  <Typography
                    variant="h5"
                    sx={{
                      fontFamily: '"Fredoka One", cursive',
                      color: '#667eea',
                      mb: 1,
                    }}
                  >
                    {user.name}
                  </Typography>
                  <Typography color="text.secondary">
                    {user.age} ans
                  </Typography>
                  <Box sx={{ mt: 2 }}>
                    {user.parentalControls.allowedSubjects.slice(0, 3).map((subject) => (
                      <Typography
                        key={subject}
                        variant="caption"
                        sx={{
                          display: 'inline-block',
                          bgcolor: '#667eea',
                          color: 'white',
                          px: 1,
                          py: 0.5,
                          borderRadius: 2,
                          mr: 0.5,
                          mb: 0.5,
                        }}
                      >
                        {subject}
                      </Typography>
                    ))}
                  </Box>
                </CardContent>
              </Card>
            </motion.div>
          </Grid>
        ))}

        {/* Bouton pour ajouter un nouvel utilisateur */}
        <Grid item xs={12} sm={6} md={4}>
          <motion.div
            initial={{ scale: 0, opacity: 0 }}
            animate={{ scale: 1, opacity: 1 }}
            transition={{ delay: users.length * 0.1, duration: 0.5 }}
            whileHover={{ scale: 1.05 }}
            whileTap={{ scale: 0.95 }}
          >
            <Card
              sx={{
                cursor: 'pointer',
                borderRadius: 4,
                boxShadow: '0 8px 32px rgba(0,0,0,0.1)',
                border: '2px dashed #667eea',
                bgcolor: 'rgba(255,255,255,0.8)',
                minHeight: 200,
                display: 'flex',
                alignItems: 'center',
                justifyContent: 'center',
                transition: 'all 0.3s ease',
                '&:hover': {
                  boxShadow: '0 12px 40px rgba(0,0,0,0.2)',
                  bgcolor: 'rgba(255,255,255,0.9)',
                },
              }}
              onClick={onShowCreateForm}
            >
              <CardContent sx={{ textAlign: 'center' }}>
                <IconButton
                  sx={{
                    width: 80,
                    height: 80,
                    bgcolor: '#667eea',
                    color: 'white',
                    mb: 2,
                    '&:hover': {
                      bgcolor: '#5a6fd8',
                    },
                  }}
                >
                  <AddIcon sx={{ fontSize: '2rem' }} />
                </IconButton>
                <Typography
                  variant="h6"
                  sx={{
                    fontFamily: '"Fredoka One", cursive',
                    color: '#667eea',
                  }}
                >
                  Nouveau profil
                </Typography>
                <Typography variant="body2" color="text.secondary">
                  Ajouter un enfant
                </Typography>
              </CardContent>
            </Card>
          </motion.div>
          </Grid>
        </Grid>
      </Box>

      {/* Admin Panel */}
      <AdminPanel
        open={adminPanelOpen}
        onClose={() => {
          setAdminPanelOpen(false);
          setAdminAuthorized(false);
        }}
        isAuthorized={adminAuthorized}
        onAuthorize={handleAdminAuthorization}
      />
    </Box>
  );
};

export default UserSelection;